---
title: "volcano"
author: "Caroline Wheeler"
date: "4/18/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(ggplot2)
library(ggrepel)
library(scales)
```

read in data
```{r}
or <- read.csv("../data/modelling_binom_Oropharynx.csv")
or$location <- "OR"
oc <- read.csv("../data/modelling_binom_OralCavity.csv")
oc$location <- "OC"
lh <- read.csv("../data/modelling_binom_LarynxHypopharinx.csv")
lh$location <- "LH"

combo <- rbind(or, oc, lh)
```

Try adjusting p-value
```{r}
combo <- combo %>%
  mutate(p.adjusted = p.adjust(p.value),
         label = ifelse(p.adjusted < 1, term, ""))

# only 2 significant p-values, all others are 1. Use un-adjusted p.value to plot.
```

```{r}
combo <- combo %>%
  mutate('log(estimate)' = ifelse(estimate > 0, log(estimate), log(abs(estimate))*-1))
```
point to highlight
```{r}
highlight_df <- combo %>% filter(p.adjusted < 1)
```

plot 
```{r fig.height=5, fig.width=6}
ggplot(data=combo,aes(x= `estimate`, y=-log10(p.value), label=label, color=location)) + 
  geom_point() + 
  theme_bw() + 
  geom_text_repel(color=muted("slategray3")) + 
  scale_color_manual(values = alpha(c("rosybrown", "slategray3", "yellow3"), .3)) +
  geom_point(data=highlight_df, 
             aes(x=`estimate`,y=-log10(p.value)), 
             color=muted("slategray3"))

#ggsave("../figures/fig1_volcano_log(estimate).png", dpi=400, device = "png", width = 6 , height = 5)
ggsave("../figures/fig1_volcano.png", dpi=400, device = "png", width = 6 , height = 5)
```


